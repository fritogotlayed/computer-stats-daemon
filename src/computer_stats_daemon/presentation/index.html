<html lang="en">
<head>
    <title>Computer Stats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="//bernii.github.io/gauge.js/dist/gauge.min.js"></script>
    <script src="//cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
</head>
<body>
<!-- https://getbootstrap.com/docs/5.3/examples/album/ -->
<h1>Computer Stats</h1>
<div class="album py-5 bg-body-tertiary">
    <div class="container">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
            <div class="col">
                <div class="card shadow-sm">
                    <canvas id='cpu-gauge'></canvas>
                    <div class="card-body">
                        <p id='cpu-label' class="card-text text-center">CPU Usage (0.0%)</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card shadow-sm">
                    <canvas id='mem-gauge'></canvas>
                    <div class="card-body">
                        <p id='mem-label' class="card-text text-center">Memory Usage (0.0%)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var opts = {
        angle: 0,
        lineWidth: 0.3,
        radiusScale: 1,
        pointer: {length: 0.6, strokeWidth: 0.035, color: '#000000'},
        staticZones: [
            {strokeStyle: '#30B32D', min: 0, max: 70},
            {strokeStyle: '#FFDD00', min: 70, max: 85},
            {strokeStyle: '#F03E3E', min: 85, max: 100}
        ],
        limitMax: true,
        limitMin: true,
        highDpiSupport: true,
        renderTicks: {
            divisions: 10,
            divWidth: 1.1,
            divLength: 0.7,
            divColor: '#333333',
            subDivisions: 2,
            subLength: 0.5,
            subWidth: 0.6,
            subColor: '#666666'
        }
    };

    const createGuage = (elementId) => {
        var target = document.getElementById(elementId);
        var gauge = new Gauge(target).setOptions(opts);
        gauge.maxValue = 100;
        gauge.setMinValue(0);
        gauge.animationSpeed = 32;
        gauge.set(0);
        return gauge;
    }

    const cpuGauge = createGuage('cpu-gauge');
    const memGauge = createGuage('mem-gauge');

    // Set up the WebSocket connection
    var socket = io('ws://localhost:8889');
    // socket.addEventListener('open', function (event) {
    //     console.log('Connected to the server');
    // });
    // socket.addEventListener('close', function (event) {
    //     console.log('Disconnected from the server');
    // });
    // socket.addEventListener('message', function (event) {
    // });
    socket.on('stats_update', function (msg, cb) {
        console.log(msg);
        const data = JSON.parse(msg);
        cpuGauge.set(data.cpu);
        memGauge.set(data.memory);

        document.getElementById('cpu-label').innerText = `CPU Usage (${data.cpu}%)`;
        document.getElementById('mem-label').innerText = `Memory Usage (${data.memory}%)`;
    })
</script>
</body>
</html>
